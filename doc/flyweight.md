# 享元模式

Flags: 设计模式 读书笔记 技术

---

享元（flyweight）模式，最适合于解决因创建大量对象而累及性能的问题。目的在于提高系统的性能和代码的效率——尤其是内存的效率。

## 享元的结构

享元模式用于减少应用程序所需对象的数量。通过将对象的内部状态划分为*内在数据（intrinsic data）*和*外在数据（extrinsic data）*两类，将内在状态相同的所有对象替换为同一个享元对象，把对象数量减少到不同内在状态的数量。

内在数据是指类的内部方法所需要的信息，没有这种数据的话，类就不能正常运转。创建这种对象需要使用工厂，以追踪到实例化的各个对象，从而仅当所需对象的内在状态不同于已有对象时才创建一个新对象。

外在数据是指可以从类身上剥离并存储在其外部管理器对象中的信息。在调用对象的方法时，管理器会把这些外在状态作为参数传入。

享元模式模式的优化是以复杂性为代价的。原先有的只是一个类，现在却变成了一个类和两个单体对象。把一个对象的数据保存在两个不同的地方这种做法也会令人困惑。但与所解决的性能问题相比，这两点都只是小问题。如果运用得当，享元模式能显著的提升程序的性能。

## 管理外在状态

管理享元对象的外在数据有许多不同的方法。
1. 使用管理器对象，这种对象有一个集中管理的数据库，用于存放外在状态及其所属的享元对象；
2. 使用组合模式，用对象自身的层次体系来保存信息，而不需要另外使用一个集中管理的数据库。

## 享元模式的适用场合

把对象转化为享元需要满足一些前提条件：
1. 必须使用了*大量*资源密集型对象；
2. 这些对象中所保存的数据至少有一部分能被转化为外在数据；
3. 将外在数据分离出去之后，享元对象的数据相对较少。

## 实现享元模式的一般步骤
1. 将所有外在数据从目标类中分离，具体做法是尽可能多的删除该类属性——那种因实例而异的属性；
2. 创建一个用来控制该类实例化的工厂；
3. 创建一个用来保存外在数据的管理器。

## 享元模式之利
享元模式可以把资源负荷降低几个数量级。

## 享元模式之弊
享元模式提高了代码的复杂程度，会给调试和维护造成困难。