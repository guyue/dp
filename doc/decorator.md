# 装饰者模式

Tags: 设计模式 读书笔记 技术

---

装饰者模式可用来透明的把对象包装在具有同样接口的另一个对象之中。这样一来，你就可以给一个方法添加一些行为，然后将方法调用传递给原始对象。相对于创建子类来说，使用装饰者对象是一种更灵活的选择。

装饰者可以用于为对象添加功能，避免使用大量所有新功能组合的子类来实现功能。装饰者模式颇多得益于接口的使用。装饰者最重要的特点之一就是它可以用来代替其组件。透明的用新对象装饰现有系统中的对象，而这并不会改变对象中的其他东西，这依赖于装饰者和组件实现了同样的接口。

## 装饰者模式和组合模式的对比

装饰者对象和组合对象都是用来包装别的对象（在装饰者模式中称为组件，在组合模式中称为子对象），它们都与所包装的对象实现同样的接口并且会把任何方法调用传递给这些对象。

组合模式是一种结构性模式，用于把众多子对象组合成一个整体。藉此程序员与大批对象打交道时可以将它们当做一个对象来对待，并将它们组织为层次性的树。通常它们并不修改方法调用，而只是将其沿组合对象和子对象的链向下传递，直到到达并落实到页对象上。

装饰者模式也是一种结构性模式，但它并非用于组织对象，而是用于在不修改现有对象也不从其派生子类的前提下为其添加职责。在一些较简单的例子中，装饰者会透明不加修改的传递所有方法的调用，不过，装饰者的目的就在于对方法进行修改。

组合对象并不修改方法调用，其着眼点在于组织子对象。而装饰者存在的唯一目的就是修改方法调用而不是组织子对象，因为子对象只有一个。

## 装饰者修改其组件的方式

1. 在方法之后添加行为；
2. 在方法之前添加行为；
3. 替换方法；
4. 添加新方法。

## 装饰者模式的适用场合

如果需要为类添加特性或职责，而从该类派生子类的解决办法并不实际的话，就应该使用装饰者模式。派生子类之所以会不实际，最常见的原因就是需要增添的特性的数量和组合要求使用大量的子类。

如果需要为对象增添特性而又不想改变使用该对象的代码的话，也可以使用装饰者模式。因为装饰者可以动态而又透明的应用对象，所以它们很适合于修改现有系统这一任务。相比卷入创建和维护子类的麻烦，创建和应用一些装饰者往往要省事很多（比如性能分析代码）。

## 装饰者模式之利

装饰者是在运行期间为对象添加特性或职责的有力工具，在只有部分对象需要这些特性的情况下装饰者模式的好处尤为突出。如果不使用装饰者模式，那么想要实现相同的效果必须使用大量子类。
装饰者模式是一种即不用创建子类，又能透明、动态的为对象添加功能的设计模式。

## 装饰者模式之弊

装饰者模式的缺点主要表现在两个方面：
1. 在遇到用装饰者包装起来的对象时，那些依赖于类型检查的代码会出问题；
2. 使用装饰者模式往往会增加架构的复杂程度。